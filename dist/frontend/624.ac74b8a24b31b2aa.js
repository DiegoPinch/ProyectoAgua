"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[624],{7845:(E,h,i)=>{i.d(h,{c:()=>t});var l=i(9413),c=i(5879),f=i(9862);let t=(()=>{class u{constructor(r){this.http=r,this.myAppUrl=l.N.endpoint,this.myApiUrlTarifasAgua="api/tarifaagua",this.myApiUrlTarifasAguaConsumo="api/tarifaagua/consumo",this.myApiUrlTarifasAguaRiego="api/tarifaagua/riego"}getTarifasAgua(){return this.http.get(`${this.myAppUrl}${this.myApiUrlTarifasAgua}`)}getTarifasRiego(){return this.http.get(`${this.myAppUrl}${this.myApiUrlTarifasAguaRiego}`)}getTarifasConsumo(){return this.http.get(`${this.myAppUrl}${this.myApiUrlTarifasAguaConsumo}`)}getTarifaAgua(r){return this.http.get(`${this.myAppUrl}${this.myApiUrlTarifasAgua}${r}`)}crearTarifaAgua(r){return this.http.post(`${this.myAppUrl}${this.myApiUrlTarifasAgua}`,r)}actualizarTarifaAgua(r,n,p,m){return this.http.put(`${this.myAppUrl}${this.myApiUrlTarifasAgua}/${r}`,{basico:n,exceso:p,met_cubicos:m})}eliminarTarifaAgua(r){return this.http.delete(`${this.myAppUrl}${this.myApiUrlTarifasAgua}${r}`)}static#t=this.\u0275fac=function(n){return new(n||u)(c.LFG(f.eN))};static#a=this.\u0275prov=c.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},6185:(E,h,i)=>{i.d(h,{m:()=>t});var l=i(9413),c=i(5879),f=i(9862);let t=(()=>{class u{constructor(r){this.http=r,this.myAppUrl=l.N.endpoint,this.myApyActFacturaporlectura="api/facturas/update",this.myApyUrl="api/facturas/",this.myApyUrlImprimir="api/imp/generar-factura"}getFacturas(r){return this.http.get(`${this.myAppUrl}${this.myApyUrl}/${r}`)}putFacturas(r){return this.fecha=(new Date).toISOString().slice(0,10),this.http.put(`${this.myAppUrl}${this.myApyUrl}/${this.fecha}/${r}`,{FEC_PAGO:this.fecha})}putFacturasForlecture(r,n,p){return this.http.put(`${this.myAppUrl}${this.myApyActFacturaporlectura}/${r}/${n}/${p}`,{EXC_LECTURA:r,SUM_TOTAL:n})}postFacturas(r){return this.http.post(`${this.myAppUrl}${this.myApyUrl}`,r)}getImprimirFacturas(r,n,p){return this.http.get(`${this.myAppUrl}${this.myApyUrlImprimir}/${r}/${n}/${p}`,{responseType:"blob"})}static#t=this.\u0275fac=function(n){return new(n||u)(c.LFG(f.eN))};static#a=this.\u0275prov=c.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},7624:(E,h,i)=>{i.d(h,{L:()=>R});var l=i(6223),c=i(7700),f=i(1686),t=i(5879),u=i(2948),L=i(6185),r=i(2939),n=i(7845),p=i(6814),m=i(3814),g=i(617),A=i(2032),U=i(9157),T=i(2296),v=i(1274);const M=["inputNombre"],O=["inputCedula"],I=["inputMedidor"],D=["inputMes"],b=["inputAnterior"];function $(d,N){1&d&&(t.TgZ(0,"span"),t._uU(1," Es una lectura "),t.TgZ(2,"strong"),t._uU(3,"incorrecta"),t.qZA()())}let R=(()=>{class d{constructor(a,e,s,o,_,C,y,P){this._medidoresService=a,this._facturas=e,this.dialogRef=s,this.dialog=o,this.fb=_,this.data=C,this.snackBar=y,this._servTarifa=P,this.metCubicosC=0,this.basicoC=0,this.excesoC=0,this.metCubicosR=0,this.basicoR=0,this.excesoR=0,this.lecturaForm=this.fb.group({CED_USU:["",l.kI.required],NOMBRES:["",l.kI.required],TIPO_MED:["",l.kI.required],LEC_ANT:["",l.kI.required],LEC_ACT:["",[l.kI.required,this.verificarLecturaIngreso.bind(this)]],MES_CON:["",l.kI.required]}),this.obtenerTarifaConsumo(),this.obtenerTarifaRiego(),this.obtenerValorConsumo(),this.obtenerValorRiego()}ngOnInit(){this.cargarDatosFormulario()}ngAfterViewInit(){this.bloquearEntradaTexto()}bloquearEntradaTexto(){this.inputCedula.nativeElement.addEventListener("keydown",a=>{a.preventDefault()}),this.inputNombre.nativeElement.addEventListener("keydown",a=>{a.preventDefault()}),this.inputMedidor.nativeElement.addEventListener("keydown",a=>{a.preventDefault()}),this.inputAnterior.nativeElement.addEventListener("keydown",a=>{a.preventDefault()}),this.inputMes.nativeElement.addEventListener("keydown",a=>{a.preventDefault()})}cargarDatosFormulario(){const a=this.data.rowData;this.lecturaForm.patchValue({CED_USU:a.CED_USU,TIPO_MED:a.TIPO_MED,NOMBRES:`${a.APE_USU} ${a.NOM_USU}`,LEC_ANT:a.LEC_ANT,LEC_ACT:a.LEC_ACT,MES_CON:a.MES_CON})}editarLectura(){const a=localStorage.getItem("tarifaConsumo"),e=localStorage.getItem("tarifaRiego");if(a&&e)if(null!==this.excesoC&&null!==this.basicoC&&this.metCubicosC&&null!==this.excesoR&&null!==this.basicoR&&this.metCubicosR){if(this.lecturaForm.valid){const s=this.data.rowData.ID_LEC,o=this.lecturaForm.get("LEC_ACT")?.value,_=o-this.data.rowData.LEC_ANT,{exceso:C,total:y}=this.calcularTotal(_);o>=this.data.rowData.LEC_ANT?this.actualizarLectura(s,o,C,y):this.mensajeError("La lectura Actual debe ser mayor a la Lectura Anterior")}}else this.mensajeError("No existen las tarifas para realizar la factura");else this.mensajeError("No existen las tarifas para realizar la factura")}calcularTotal(a){let e=0,s=0;return"CONSUMO"===this.data.selectedTipo?a>=this.metCubicosC?(e=a-this.metCubicosC,s=this.basicoC+e*this.excesoC):s=this.basicoC:"RIEGO"===this.data.selectedTipo&&(a>=this.metCubicosR?(e=a-this.metCubicosR,s=this.basicoR+e*this.excesoR):s=this.basicoR),{exceso:e,total:+s.toFixed(2)}}obtenerTarifaConsumo(){const a=localStorage.getItem("tarifaConsumo");if(a)try{const e=JSON.parse(a);if(Array.isArray(e)&&e.length>0){const{met_cubicos:s,basico:o,exceso:_}=e[0];this.metCubicosC=s,this.basicoC=o,this.excesoC=_}else console.log("El array est\xe1 vac\xedo o no es v\xe1lido")}catch(e){console.error("Error al analizar datos del localStorage:",e)}else console.log("Las tarifas no est\xe1n disponibles en el localStorage."),this.obtenerTarifaConsumo()}obtenerTarifaRiego(){const a=localStorage.getItem("tarifaRiego");if(a)try{const e=JSON.parse(a);if(Array.isArray(e)&&e.length>0){const{met_cubicos:s,basico:o,exceso:_}=e[0];this.metCubicosR=s,this.basicoR=o,this.excesoR=_}else console.log("El array est\xe1 vac\xedo o no es v\xe1lido")}catch(e){console.error("Error al analizar datos del localStorage:",e)}else console.log("Las tarifas no est\xe1n disponibles en el localStorage."),this.obtenerTarifaRiego()}obtenerValorConsumo(){this._servTarifa.getTarifasConsumo().subscribe(a=>{localStorage.setItem("tarifaConsumo",JSON.stringify(a))},a=>{console.error("Error al obtener las tarifas:",a)})}obtenerValorRiego(){this._servTarifa.getTarifasRiego().subscribe(a=>{localStorage.setItem("tarifaRiego",JSON.stringify(a))},a=>{console.error("Error al obtener las tarifas:",a)})}actualizarLectura(a,e,s,o){this._medidoresService.putLectura(e,a).subscribe(()=>{this.cerrarModal(),this.showMessage("Lectura editada correctamente"),this.editarFactura(s,o,a)},_=>{409===_.status?this.mensajeError("La lectura no se puede editar, la factura ya est\xe1 pagada."):(console.error("Error al intentar editar",_),this.showMessage("Ocurri\xf3 un error al intentar editar la lectura"))})}editarFactura(a,e,s){this._facturas.putFacturasForlecture(a,e,s).subscribe(()=>{},o=>{console.error("Error al editar Factura:",o)})}mensajeError(a){this.dialog.open(f.t,{data:{title:"Aviso",message:a}})}cerrarModal(){this.dialogRef.close()}showMessage(a,e=5e3){this.snackBar.open(a,"",{duration:e})}verificarLecturaIngreso(a){if(!a.dirty||!a.value)return null;const e=parseFloat(this.lecturaForm.get("LEC_ANT")?.value);return parseFloat(a.value)>=e?null:{lecturaInvalida:!0}}static#t=this.\u0275fac=function(e){return new(e||d)(t.Y36(u.I),t.Y36(L.m),t.Y36(c.so),t.Y36(c.uw),t.Y36(l.qu),t.Y36(c.WI),t.Y36(r.ux),t.Y36(n.c))};static#a=this.\u0275cmp=t.Xpm({type:d,selectors:[["gst-editar"]],viewQuery:function(e,s){if(1&e&&(t.Gf(M,5),t.Gf(O,5),t.Gf(I,5),t.Gf(D,5),t.Gf(b,5)),2&e){let o;t.iGM(o=t.CRH())&&(s.inputNombre=o.first),t.iGM(o=t.CRH())&&(s.inputCedula=o.first),t.iGM(o=t.CRH())&&(s.inputMedidor=o.first),t.iGM(o=t.CRH())&&(s.inputMes=o.first),t.iGM(o=t.CRH())&&(s.inputAnterior=o.first)}},decls:49,vars:3,consts:[["fxLayout","","fxLayoutAlign","space-between center"],["mat-icon-button","","mat-dialog-close",""],["fxLayout","column",3,"formGroup"],["fxLayout","row","fxLayoutGap","24px"],["appearance","outline"],["formControlName","CED_USU","matInput","","autocomplete","off"],["inputCedula",""],["formControlName","NOMBRES","matInput","","autocomplete","off"],["inputNombre",""],["formControlName","TIPO_MED","matInput","","autocomplete","off"],["inputMedidor",""],["formControlName","MES_CON","matInput","","autocomplete","off"],["inputMes",""],["formControlName","LEC_ANT","matInput","","autocomplete","off"],["inputAnterior",""],["formControlName","LEC_ACT","matInput","","type","number","placeholder","Ingrese Lectura Actual","autocomplete","off"],[1,"error"],[4,"ngIf"],["fxLayout","","fxLayoutAlign","end","fxLayoutGap","10px"],["mat-button","","color","primary",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click"]],template:function(e,s){if(1&e&&(t.TgZ(0,"mat-toolbar",0)(1,"h3"),t._uU(2,"Editar Lectura"),t.qZA(),t.TgZ(3,"button",1)(4,"mat-icon"),t._uU(5,"close"),t.qZA()()(),t.TgZ(6,"mat-dialog-content")(7,"form",2)(8,"div",3)(9,"mat-form-field",4)(10,"mat-label"),t._uU(11," C\xe9dula "),t.qZA(),t._UZ(12,"input",5,6),t.qZA(),t.TgZ(14,"mat-form-field",4)(15,"mat-label"),t._uU(16," Nombres "),t.qZA(),t._UZ(17,"input",7,8),t.qZA()(),t.TgZ(19,"div",3)(20,"mat-form-field",4)(21,"mat-label"),t._uU(22," Tipo "),t.qZA(),t._UZ(23,"input",9,10),t.qZA(),t.TgZ(25,"mat-form-field",4)(26,"mat-label"),t._uU(27,"Mes Actual"),t.qZA(),t._UZ(28,"input",11,12),t.qZA()(),t.TgZ(30,"div",3)(31,"div")(32,"mat-form-field",4)(33,"mat-label"),t._uU(34," Lectura Anterior "),t.qZA(),t._UZ(35,"input",13,14),t.qZA()(),t.TgZ(37,"div")(38,"mat-form-field",4)(39,"mat-label"),t._uU(40,"Lectura Actual"),t.qZA(),t._UZ(41,"input",15),t.qZA(),t.TgZ(42,"div",16),t.YNc(43,$,4,0,"span",17),t.qZA()()(),t.TgZ(44,"div",18)(45,"button",19),t.NdJ("click",function(){return s.cerrarModal()}),t._uU(46,"Cancelar"),t.qZA(),t.TgZ(47,"button",20),t.NdJ("click",function(){return s.editarLectura()}),t._uU(48," Guardar"),t.qZA()()()()),2&e){let o;t.xp6(7),t.Q6J("formGroup",s.lecturaForm),t.xp6(36),t.Q6J("ngIf",null==(o=s.lecturaForm.get("LEC_ACT"))?null:o.hasError("lecturaInvalida")),t.xp6(4),t.Q6J("disabled",s.lecturaForm.invalid)}},dependencies:[p.O5,m.xw,m.SQ,m.Wh,g.Hw,A.Nt,U.KE,U.hX,T.lW,T.RK,l._Y,l.Fj,l.wV,l.JJ,l.JL,v.Ye,c.ZT,c.xY,l.sg,l.u],styles:["mat-form-field[_ngcontent-%COMP%]{width:45vh}.error[_ngcontent-%COMP%]{color:brown;margin-top:-20px}"]})}return d})()},2948:(E,h,i)=>{i.d(h,{I:()=>t});var l=i(9413),c=i(5879),f=i(9862);let t=(()=>{class u{constructor(r){this.http=r,this.myAppUrl=l.N.endpoint,this.myApyUrl="api/lecturas/",this.myAppiget="api/lecturas/ingresolectura",this.myappVerificarLectura="api/lecturas/verificarlectura",this.lastLecture="api/lecturas/ultimalectura"}getLecturaActual(r,n,p){return this.http.get(`${this.myAppUrl}${this.myApyUrl}/${r}/${n}/${p}`)}getLecturas(r,n){return this.http.get(`${this.myAppUrl}${this.myApyUrl}/${r}/${n}`)}getultimaLecturaInsertada(r){return this.http.get(`${this.myAppUrl}${this.lastLecture}/${r}`)}getPersonaMedidor(r){return this.http.get(`${this.myAppUrl}${this.myApyUrl}${r}`)}getLecturaIngresoMedidor(r){return this.http.get(`${this.myAppUrl}${this.myAppiget}/${r}`)}verificarLecturaExistente(r,n){return this.http.get(`${this.myAppUrl}${this.myappVerificarLectura}/${r}/${n}`)}postLecturas(r,n,p,m,g){return this.http.post(`${this.myAppUrl}${this.myApyUrl}`,{LEC_ANT:r,LEC_ACT:n,FEC_ING_LEC:p,MES_CON:m,ID_MED_LEC:g})}putLectura(r,n){return this.http.put(`${this.myAppUrl}${this.myApyUrl}/${r}/${n}`,{LEC_ACT:r})}static#t=this.\u0275fac=function(n){return new(n||u)(c.LFG(f.eN))};static#a=this.\u0275prov=c.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()}}]);