"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[592],{6185:(g,h,e)=>{e.d(h,{m:()=>t});var l=e(9413),_=e(5879),E=e(9862);let t=(()=>{class u{constructor(a){this.http=a,this.myAppUrl=l.N.endpoint,this.myApyActFacturaporlectura="api/facturas/update",this.myApyUrl="api/facturas/",this.myApyUrlImprimir="api/imp/generar-factura"}getFacturas(a){return this.http.get(`${this.myAppUrl}${this.myApyUrl}/${a}`)}putFacturas(a){return this.fecha="2023-11-09",this.http.put(`${this.myAppUrl}${this.myApyUrl}/${this.fecha}/${a}`,{FEC_PAGO:this.fecha})}putFacturasForlecture(a,s,n){return this.http.put(`${this.myAppUrl}${this.myApyActFacturaporlectura}/${a}/${s}/${n}`,{EXC_LECTURA:a,SUM_TOTAL:s})}postFacturas(a){return this.http.post(`${this.myAppUrl}${this.myApyUrl}`,a)}getImprimirFacturas(a,s,n){return this.http.get(`${this.myAppUrl}${this.myApyUrlImprimir}/${a}/${s}/${n}`,{responseType:"blob"})}static#t=this.\u0275fac=function(s){return new(s||u)(_.LFG(E.eN))};static#a=this.\u0275prov=_.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},7624:(g,h,e)=>{e.d(h,{L:()=>T});var l=e(6223),_=e(7700),E=e(6097),t=e(5879),u=e(2948),L=e(6185),a=e(2939),s=e(6814),n=e(3814),d=e(617),f=e(2032),A=e(9157),U=e(2296),C=e(1274);function y(p,I){1&p&&(t.TgZ(0,"span"),t._uU(1," Es una lectura "),t.TgZ(2,"strong"),t._uU(3,"incorrecta"),t.qZA()())}let T=(()=>{class p{constructor(r,o,i,c,m,M,O){this._medidoresService=r,this._facturas=o,this.dialogRef=i,this.dialog=c,this.fb=m,this.data=M,this.snackBar=O,this.mes="cambiar",this.lecturaForm=this.fb.group({CED_USU:["",l.kI.required],NOMBRES:["",l.kI.required],TIPO_MED:["",l.kI.required],LEC_ANT:["",l.kI.required],LEC_ACT:["",[l.kI.required,this.verificarLecturaIngreso.bind(this)]],MES_CON:["",l.kI.required]})}ngOnInit(){this.cargarDatosFormulario()}cargarDatosFormulario(){const r=this.data.rowData;this.lecturaForm.patchValue({CED_USU:r.CED_USU,TIPO_MED:r.TIPO_MED,NOMBRES:`${r.APE_USU} ${r.NOM_USU}`,LEC_ANT:r.LEC_ANT,LEC_ACT:r.LEC_ACT,MES_CON:r.MES_CON})}editarLectura(){if(this.lecturaForm.valid){const r=this.data.rowData.ID_LEC,o=this.lecturaForm.get("LEC_ACT")?.value,i=o-this.data.rowData.LEC_ANT,{exceso:c,total:m}=this.calcularTotal(i);o>=this.data.rowData.LEC_ANT?this.actualizarLectura(r,o,c,m):this.mensajeError("La lectura Actual debe ser mayor a la Lectura Anterior")}}calcularTotal(r){let o=0,i=0;return"CONSUMO"===this.data.selectedTipo?r>=10?(o=r-10,i=1.5+.28*o):i=1.5:"RIEGO"===this.data.selectedTipo&&(r>=20?(o=r-20,i=5.5+.28*o):i=5.5),i=+i.toFixed(2),{exceso:o,total:i}}actualizarLectura(r,o,i,c){this._medidoresService.putLectura(o,r).subscribe(()=>{this.cerrarModal(),this.showMessage("Lectura editada correctamente"),this.editarFactura(i,c,r)},m=>{409===m.status?this.mensajeError("La lectura no se puede editar, la factura ya est\xe1 pagada."):(console.error("Error al intentar editar",m),this.showMessage("Ocurri\xf3 un error al intentar editar la lectura"))})}editarFactura(r,o,i){this._facturas.putFacturasForlecture(r,o,i).subscribe(()=>{},c=>{console.error("Error al editar Factura:",c)})}mensajeError(r){this.dialog.open(E.P,{data:{title:"Aviso",message:r}})}cerrarModal(){this.dialogRef.close()}showMessage(r,o=5e3){this.snackBar.open(r,"",{duration:o})}verificarLecturaIngreso(r){if(!r.dirty||!r.value)return null;const o=parseFloat(this.lecturaForm.get("LEC_ANT")?.value);return parseFloat(r.value)>=o?null:{lecturaInvalida:!0}}static#t=this.\u0275fac=function(o){return new(o||p)(t.Y36(u.I),t.Y36(L.m),t.Y36(_.so),t.Y36(_.uw),t.Y36(l.qu),t.Y36(_.WI),t.Y36(a.ux))};static#a=this.\u0275cmp=t.Xpm({type:p,selectors:[["gst-editar"]],decls:47,vars:4,consts:[["fxLayout","","fxLayoutAlign","space-between center"],["mat-icon-button","","mat-dialog-close",""],["fxLayout","column",3,"formGroup"],["fxLayout","row","fxLayoutGap","24px"],["appearance","outline"],["formControlName","CED_USU","matInput","","autocomplete","off"],["formControlName","NOMBRES","matInput","","autocomplete","off"],["formControlName","TIPO_MED","matInput","","autocomplete","off"],["formControlName","MES_CON","matInput","","autocomplete","off"],["formControlName","LEC_ANT","matInput","","autocomplete","off"],["formControlName","LEC_ACT","matInput","","type","number","placeholder","Ingrese Lectura Actual","autocomplete","off"],[1,"error"],[4,"ngIf"],["fxLayout","","fxLayoutAlign","end","fxLayoutGap","10px"],["mat-button","","color","primary",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click"]],template:function(o,i){if(1&o&&(t.TgZ(0,"mat-toolbar",0)(1,"h3"),t._uU(2,"Editar Lectura"),t.qZA(),t.TgZ(3,"button",1)(4,"mat-icon"),t._uU(5,"close"),t.qZA()()(),t.TgZ(6,"mat-dialog-content")(7,"form",2)(8,"div",3)(9,"mat-form-field",4)(10,"mat-label"),t._uU(11," C\xe9dula "),t.qZA(),t._UZ(12,"input",5),t.qZA(),t.TgZ(13,"mat-form-field",4)(14,"mat-label"),t._uU(15," Nombres "),t.qZA(),t._UZ(16,"input",6),t.qZA()(),t.TgZ(17,"div",3)(18,"mat-form-field",4)(19,"mat-label"),t._uU(20," Tipo "),t.qZA(),t._UZ(21,"input",7),t.qZA(),t.TgZ(22,"mat-form-field",4)(23,"mat-label"),t._uU(24,"Mes Actual"),t.qZA(),t._UZ(25,"input",8),t.qZA()(),t.TgZ(26,"div",3)(27,"div")(28,"mat-form-field",4)(29,"mat-label"),t._uU(30," Lectura Anterior "),t.qZA(),t._UZ(31,"input",9),t.qZA(),t.TgZ(32,"div")(33,"span"),t._uU(34),t.qZA()()(),t.TgZ(35,"div")(36,"mat-form-field",4)(37,"mat-label"),t._uU(38,"Lectura Actual"),t.qZA(),t._UZ(39,"input",10),t.qZA(),t.TgZ(40,"div",11),t.YNc(41,y,4,0,"span",12),t.qZA()()(),t.TgZ(42,"div",13)(43,"button",14),t.NdJ("click",function(){return i.cerrarModal()}),t._uU(44,"Cancelar"),t.qZA(),t.TgZ(45,"button",15),t.NdJ("click",function(){return i.editarLectura()}),t._uU(46," Guardar"),t.qZA()()()()),2&o){let c;t.xp6(7),t.Q6J("formGroup",i.lecturaForm),t.xp6(27),t.Oqu(i.mes),t.xp6(7),t.Q6J("ngIf",null==(c=i.lecturaForm.get("LEC_ACT"))?null:c.hasError("lecturaInvalida")),t.xp6(4),t.Q6J("disabled",i.lecturaForm.invalid)}},dependencies:[s.O5,n.xw,n.SQ,n.Wh,d.Hw,f.Nt,A.KE,A.hX,U.lW,U.RK,l._Y,l.Fj,l.wV,l.JJ,l.JL,C.Ye,_.ZT,_.xY,l.sg,l.u],styles:["mat-form-field[_ngcontent-%COMP%]{width:45vh}.error[_ngcontent-%COMP%]{color:brown;margin-top:-20px}"]})}return p})()},2948:(g,h,e)=>{e.d(h,{I:()=>t});var l=e(9413),_=e(5879),E=e(9862);let t=(()=>{class u{constructor(a){this.http=a,this.myAppUrl=l.N.endpoint,this.myApyUrl="api/lecturas/",this.myAppiget="api/lecturas/ingresolectura",this.myappVerificarLectura="api/lecturas/verificarlectura",this.lastLecture="api/lecturas/ultimalectura"}getLecturaActual(a,s,n){return this.http.get(`${this.myAppUrl}${this.myApyUrl}/${a}/${s}/${n}`)}getLecturas(a,s){return this.http.get(`${this.myAppUrl}${this.myApyUrl}/${a}/${s}`)}getultimaLecturaInsertada(a){return this.http.get(`${this.myAppUrl}${this.lastLecture}/${a}`)}getPersonaMedidor(a){return this.http.get(`${this.myAppUrl}${this.myApyUrl}${a}`)}getLecturaIngresoMedidor(a){return this.http.get(`${this.myAppUrl}${this.myAppiget}/${a}`)}verificarLecturaExistente(a,s){return this.http.get(`${this.myAppUrl}${this.myappVerificarLectura}/${a}/${s}`)}postLecturas(a,s,n,d,f){return this.http.post(`${this.myAppUrl}${this.myApyUrl}`,{LEC_ANT:a,LEC_ACT:s,FEC_ING_LEC:n,MES_CON:d,ID_MED_LEC:f})}putLectura(a,s){return this.http.put(`${this.myAppUrl}${this.myApyUrl}/${a}/${s}`,{LEC_ACT:a})}static#t=this.\u0275fac=function(s){return new(s||u)(_.LFG(E.eN))};static#a=this.\u0275prov=_.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()}}]);